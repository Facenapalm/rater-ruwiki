!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";var _setup=_interopRequireDefault(require("./setup")),_autostart=_interopRequireDefault(require("./autostart")),_css=_interopRequireDefault(require("./css.js")),_util=require("./util"),_windowManager=_interopRequireDefault(require("./windowManager"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}!function(){console.log("Rater's App.js is running..."),mw.util.addCSS(_css.default);var showMainWindow=function(data){data&&data.success&&_windowManager.default.openWindow("main",data)},showSetupError=function(code,jqxhr){return OO.ui.alert((0,_util.makeErrorMsg)(code,jqxhr),{title:"Rater failed to open"})};mw.util.addPortletLink("p-cactions","#","Rater","ca-rater","Rate quality and importance","5"),$("#ca-rater").click(function(){return(0,_setup.default)().then(showMainWindow,showSetupError)}),(0,_autostart.default)().then(showMainWindow)}()},{"./autostart":10,"./css.js":13,"./setup":15,"./util":16,"./windowManager":17}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getWithRedirectTo=exports.parseTemplates=exports.Template=void 0;var obj,_util=require("./util"),_config=(obj=require("./config"))&&obj.__esModule?obj:{default:obj},cache=function(obj){if(obj&&obj.__esModule)return obj;var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={};if(null!=obj){var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(require("./cache"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}var Template=function(wikitext){this.wikitext=wikitext,this.parameters=[]};(exports.Template=Template).prototype.addParam=function(name,val,wikitext){this.parameters.push({name:name,value:val,wikitext:"|"+wikitext})},Template.prototype.getParam=function(paramName){return this.parameters.find(function(p){return p.name==paramName})},Template.prototype.setName=function(name){this.name=name.trim()},Template.prototype.getTitle=function(){return mw.Title.newFromText("Template:"+this.name)};exports.parseTemplates=function parseTemplates(wikitext,recursive){if(!wikitext)return[];for(var startIdx,strReplaceAt=function(string,index,_char){return string.slice(0,index)+_char+string.slice(index+1)},result=[],processTemplateText=function(startIdx,endIdx){for(var text=wikitext.slice(startIdx,endIdx),template=new Template("{{"+text.replace(/\x01/g,"|")+"}}");/(\[\[[^\]]*?)\|(.*?\]\])/g.test(text);)text=text.replace(/(\[\[[^\]]*?)\|(.*?\]\])/g,"$1$2");var chunks=text.split("|").map(function(chunk){return chunk.replace(/\x01/g,"|")});template.setName(chunks[0]);var parameterChunks=chunks.slice(1),unnamedIdx=1;parameterChunks.forEach(function(chunk){var pName,pNum,pVal,indexOfEqualTo=chunk.indexOf("="),indexOfOpenBraces=chunk.indexOf("{{"),isWithoutEquals=!chunk.includes("="),hasBracesBeforeEquals=chunk.includes("{{")&&indexOfOpenBraces<indexOfEqualTo;if(isWithoutEquals||hasBracesBeforeEquals){for(;template.getParam(unnamedIdx);)unnamedIdx++;pNum=unnamedIdx,pVal=chunk.trim()}else pName=chunk.slice(0,indexOfEqualTo).trim(),pVal=chunk.slice(indexOfEqualTo+1).trim();template.addParam(pName||pNum,pVal,chunk)}),result.push(template)},n=wikitext.length,numUnclosed=0,inComment=!1,inNowiki=!1,i=0;i<n;i++)inComment||inNowiki?"|"===wikitext[i]?wikitext=strReplaceAt(wikitext,i,""):/^-->/.test(wikitext.slice(i,i+3))?(inComment=!1,i+=2):/^<\/nowiki ?>/.test(wikitext.slice(i,i+10))&&(inNowiki=!1,i+=8):"{"===wikitext[i]&&"{"===wikitext[i+1]?(0===numUnclosed&&(startIdx=i+2),numUnclosed+=2,i++):"}"===wikitext[i]&&"}"===wikitext[i+1]?(2===numUnclosed&&processTemplateText(startIdx,i),numUnclosed-=2,i++):"|"===wikitext[i]&&2<numUnclosed?wikitext=strReplaceAt(wikitext,i,""):/^<!--/.test(wikitext.slice(i,i+4))?(inComment=!0,i+=3):/^<nowiki ?>/.test(wikitext.slice(i,i+9))&&(inNowiki=!0,i+=7);if(recursive){var subtemplates=result.map(function(template){return template.wikitext.slice(2,-2)}).filter(function(templateWikitext){return/\{\{.*\}\}/.test(templateWikitext)}).map(function(templateWikitext){return parseTemplates(templateWikitext,!0)});return result.concat.apply(result,subtemplates)}return result};exports.getWithRedirectTo=function(templates){var templatesArray=Array.isArray(templates)?templates:[templates];return 0===templatesArray.length?$.Deferred().resolve([]):_util.API.get({action:"query",format:"json",titles:templatesArray.map(function(template){return template.getTitle().getPrefixedText()}),redirects:1}).then(function(result){return result&&result.query?(result.query.redirects&&result.query.redirects.forEach(function(redirect){var i=templatesArray.findIndex(function(template){return template.getTitle().getPrefixedText()===redirect.from});-1!==i&&(templatesArray[i].redirectTarget=mw.Title.newFromText(redirect.to))}),Array.isArray(templates)?templatesArray:templatesArray[0]):$.Deferred().reject("Empty response")})},Template.prototype.getDataForParam=function(key,paraName){if(!this.paramData)return null;var para=this.paramAliases[paraName]||paraName;if(this.paramData[para]){var data=this.paramData[para][key];return data&&data.en&&!Array.isArray(data)?data.en:data}},Template.prototype.setParamDataAndSuggestions=function(){var self=this,paramDataSet=$.Deferred();if(self.paramData)return paramDataSet.resolve();var prefixedText=self.redirectTarget?self.redirectTarget.getPrefixedText():self.getTitle().getPrefixedText(),cachedInfo=cache.read(prefixedText+"-params");return cachedInfo&&cachedInfo.value&&cachedInfo.staleDate&&null!=cachedInfo.value.paramData&&null!=cachedInfo.value.parameterSuggestions&&null!=cachedInfo.value.paramAliases&&(self.notemplatedata=cachedInfo.value.notemplatedata,self.paramData=cachedInfo.value.paramData,self.parameterSuggestions=cachedInfo.value.parameterSuggestions,self.paramAliases=cachedInfo.value.paramAliases,paramDataSet.resolve(),!(0,_util.isAfterDate)(cachedInfo.staleDate))||_util.API.get({action:"templatedata",titles:prefixedText,redirects:1,includeMissingTitles:1}).then(function(response){return response},function(){return null}).then(function(result){var id=result&&$.map(result.pages,function(_value,key){return key});result&&result.pages[id]&&!result.pages[id].notemplatedata&&result.pages[id].params?self.paramData=result.pages[id].params:(self.notemplatedata=!0,self.templatedataApiError=!result,self.paramData=_config.default.defaultParameterData),self.paramAliases={},$.each(self.paramData,function(paraName,paraData){if(paraData.aliases&&paraData.aliases.length&&paraData.aliases.forEach(function(alias){self.paramAliases[alias]=paraName}),paraData.description&&/\[.*'.+?'.*?\]/.test(paraData.description.en))try{var allowedVals=JSON.parse(paraData.description.en.replace(/^.*\[/,"[").replace(/"/g,'\\"').replace(/'/g,'"').replace(/,\s*]/,"]").replace(/].*$/,"]"));self.paramData[paraName].allowedValues=allowedVals}catch(e){console.warn("[Rater] Could not parse allowed values in description:\n  "+paraData.description.en+"\n Check TemplateData for parameter |"+paraName+"= in "+self.getTitle().getPrefixedText())}if((paraData.required||paraData.suggested)&&!self.getParam(paraName)){if(paraData.aliases.length)if(self.parameters.filter(function(p){var isAlias=paraData.aliases.includes(p.name),isEmpty=!p.val;return isAlias&&!isEmpty}).length)return;self.parameters.push({name:paraName,value:paraData.autovalue||"",autofilled:!0})}});var allParamsArray=!self.notemplatedata&&result.pages[id].paramOrder||$.map(self.paramData,function(_val,key){return key});return self.parameterSuggestions=allParamsArray.filter(function(paramName){return paramName&&"class"!==paramName&&"importance"!==paramName}).map(function(paramName){var optionObject={data:paramName},label=self.getDataForParam(label,paramName);return label&&(optionObject.label=label+" (|"+paramName+"=)"),optionObject}),self.templatedataApiError||cache.write(prefixedText+"-params",{notemplatedata:self.notemplatedata,paramData:self.paramData,parameterSuggestions:self.parameterSuggestions,paramAliases:self.paramAliases},1),!0}).then(paramDataSet.resolve,paramDataSet.reject),paramDataSet},Template.prototype.setClassesAndImportances=function(){var _this=this,parsed=$.Deferred();if(this.classes&&this.importances)return parsed.resolve();var mainText=this.getTitle().getMainText(),cachedRatings=cache.read(mainText+"-ratings");if(cachedRatings&&cachedRatings.value&&cachedRatings.staleDate&&null!=cachedRatings.value.classes&&null!=cachedRatings.value.importances&&(this.classes=cachedRatings.value.classes,this.importances=cachedRatings.value.importances,parsed.resolve(),!(0,_util.isAfterDate)(cachedRatings.staleDate)))return parsed;var wikitextToParse="";return _config.default.bannerDefaults.extendedClasses.forEach(function(classname,index){wikitextToParse+="{{"+mainText+"|class="+classname+"|importance="+(_config.default.bannerDefaults.extendedImportances[index]||"")+"}}/n"}),_util.API.get({action:"parse",title:"Talk:Sandbox",text:wikitextToParse,prop:"categorieshtml"}).then(function(result){var redirectOrMainText=_this.redirectTarget?_this.redirectTarget.getMainText():mainText,catsHtml=result.parse.categorieshtml["*"],extendedClasses=_config.default.bannerDefaults.extendedClasses.filter(function(cl){return-1!==catsHtml.indexOf(cl+"-Class")}),defaultClasses="WikiProject Portals"===redirectOrMainText?["List"]:_config.default.bannerDefaults.classes,customClasses=_config.default.customClasses[redirectOrMainText]||[];return _this.classes=[].concat(customClasses,defaultClasses,extendedClasses),_this.importances=_config.default.bannerDefaults.extendedImportances.filter(function(imp){return-1!==catsHtml.indexOf(imp+"-importance")}),cache.write(mainText+"-ratings",{classes:_this.classes,importances:_this.importances},1),!0})}},{"./cache":11,"./config":12,"./util":16}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;function BannerListWidget(config){config=config||{},BannerListWidget.parent.call(this,config),OO.ui.mixin.GroupElement.call(this,{$group:this.$element}),this.$element.css({padding:"20px 10px 16px 10px"}),this.aggregate({remove:"bannerRemove"}),this.connect(this,{bannerRemove:"onBannerRemove"})}OO.inheritClass(BannerListWidget,OO.ui.Widget),OO.mixinClass(BannerListWidget,OO.ui.mixin.GroupElement),BannerListWidget.prototype.onBannerRemove=function(banner){this.removeItems([banner])};var _default=BannerListWidget;exports.default=_default},{}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ParameterListWidget=_interopRequireDefault(require("./ParameterListWidget")),_ParameterWidget=_interopRequireDefault(require("./ParameterWidget")),_SuggestionLookupTextInputWidget=_interopRequireDefault(require("./SuggestionLookupTextInputWidget"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function BannerWidget(template,config){var _this=this;config=config||{},BannerWidget.super.call(this,config),this.template=template,this.removeButton=new OO.ui.ButtonWidget({icon:"trash",label:"Remove banner",title:"Remove banner",flags:"destructive",$element:$('<div style="width:100%">')}),this.clearButton=new OO.ui.ButtonWidget({icon:"cancel",label:"Clear parameters",title:"Clear parameters",flags:"destructive",$element:$('<div style="width:100%">')}),this.bypassButton=new OO.ui.ButtonWidget({icon:"articleRedirect",label:"Bypass redirect",title:"Bypass redirect",$element:$('<div style="width:100%">')}),this.removeButton.$element.find("a").css("width","100%"),this.clearButton.$element.find("a").css("width","100%"),this.bypassButton.$element.find("a").css("width","100%"),this.titleButtonsGroup=new OO.ui.ButtonGroupWidget({items:template.redirectTarget?[this.removeButton,this.clearButton,this.bypassButton]:[this.removeButton,this.clearButton],$element:$("<span style='width:100%;'>")}),this.mainLabelPopupButton=new OO.ui.PopupButtonWidget({label:"{{"+this.template.getTitle().getMainText()+"}}",$element:$("<span style='display:inline-block;width:48%;margin-right:0;padding-right:8px'>"),indicator:"down",framed:!1,popup:{$content:this.titleButtonsGroup.$element,width:200,padded:!1,align:"force-right",anchor:!1}}),this.mainLabelPopupButton.$element.children("a").first().css({"font-size":"110%"}).find("span.oo-ui-labelElement-label").css({"white-space":"normal"}),this.classDropdown=new OO.ui.DropdownWidget({label:new OO.ui.HtmlSnippet('<span style="color:#777">Class</span>'),menu:{items:[new OO.ui.MenuOptionWidget({data:"",label:" "}),new OO.ui.MenuOptionWidget({data:"B",label:"B"}),new OO.ui.MenuOptionWidget({data:"C",label:"C"}),new OO.ui.MenuOptionWidget({data:"start",label:"Start"})]},$element:$("<span style='display:inline-block;width:24%'>"),$overlay:this.$overlay}),this.importanceDropdown=new OO.ui.DropdownWidget({label:new OO.ui.HtmlSnippet('<span style="color:#777">Importance</span>'),menu:{items:[new OO.ui.MenuOptionWidget({data:"",label:" "}),new OO.ui.MenuOptionWidget({data:"top",label:"Top"}),new OO.ui.MenuOptionWidget({data:"high",label:"High"}),new OO.ui.MenuOptionWidget({data:"mid",label:"Mid"})]},$element:$("<span style='display:inline-block;width:24%'>"),$overlay:this.$overlay}),this.titleLayout=new OO.ui.HorizontalLayout({items:[this.mainLabelPopupButton,this.classDropdown,this.importanceDropdown]});var parameterWidgets=this.template.parameters.filter(function(param){return"class"!==param.name&&"importance"!==param.name}).map(function(param){return new _ParameterWidget.default(param,_this.template.paramData[param.name])});this.parameterList=new _ParameterListWidget.default({items:parameterWidgets,displayLimit:6}),this.addParameterNameInput=new _SuggestionLookupTextInputWidget.default({suggestions:this.template.parameterSuggestions,placeholder:"parameter name",$element:$("<div style='display:inline-block;width:40%'>"),validate:function(val){var _this$getAddParameter=this.getAddParametersInfo(val),validName=_this$getAddParameter.validName,name=_this$getAddParameter.name,value=_this$getAddParameter.value;return!name&&!value||validName}.bind(this)}),this.addParameterValueInput=new _SuggestionLookupTextInputWidget.default({placeholder:"parameter value",$element:$("<div style='display:inline-block;width:40%'>"),validate:function(val){var _this$getAddParameter2=this.getAddParametersInfo(null,val),validValue=_this$getAddParameter2.validValue,name=_this$getAddParameter2.name,value=_this$getAddParameter2.value;return!name&&!value||validValue}.bind(this)}),this.addParameterButton=new OO.ui.ButtonWidget({label:"Add",icon:"add",flags:"progressive"}).setDisabled(!0),this.addParameterControls=new OO.ui.HorizontalLayout({items:[this.addParameterNameInput,new OO.ui.LabelWidget({label:"="}),this.addParameterValueInput,this.addParameterButton]}),this.addParameterControls.getInputId=function(){return!1},this.addParameterControls.isDisabled=function(){return!1},this.addParameterControls.simulateLabelClick=function(){return!0},this.addParameterLayout=new OO.ui.FieldLayout(this.addParameterControls,{label:"Add parameter:",align:"top"}).toggle(!1),this.addParameterLayout.$element.find(".oo-ui-fieldLayout-messages").css({clear:"both","padding-top":0}),this.$element.append(this.titleLayout.$element,this.parameterList.$element,this.addParameterLayout.$element,$("<hr>")),this.parameterList.connect(this,{addParametersButtonClick:"showAddParameterInputs"}),this.addParameterButton.connect(this,{click:"onParameterAdd"}),this.addParameterNameInput.connect(this,{change:"onAddParameterNameChange"}),this.addParameterValueInput.connect(this,{change:"onAddParameterValueChange"}),this.removeButton.connect(this,{click:"onRemoveButtonClick"})}OO.inheritClass(BannerWidget,OO.ui.Widget),BannerWidget.prototype.showAddParameterInputs=function(){this.addParameterLayout.toggle(!0)},BannerWidget.prototype.getAddParametersInfo=function(nameInputVal,valueInputVal){var name=nameInputVal&&nameInputVal.trim()||this.addParameterNameInput.getValue().trim(),paramAlreadyIncluded="class"===name||"importance"===name||this.parameterList.items.some(function(paramWidget){return paramWidget.parameter&&paramWidget.parameter.name===name}),value=valueInputVal&&valueInputVal.trim()||this.addParameterValueInput.getValue().trim(),autovalue=name&&this.template.paramData[name]&&this.template.paramData[name].autovalue||null;return{validName:!(!name||paramAlreadyIncluded),validValue:!(!value&&!autovalue),isAutovalue:!(value||!autovalue),isAlreadyIncluded:!(!name||!paramAlreadyIncluded),name:name,value:value,autovalue:autovalue}},BannerWidget.prototype.onAddParameterNameChange=function(){var _this$getAddParameter3=this.getAddParametersInfo(),validName=_this$getAddParameter3.validName,validValue=_this$getAddParameter3.validValue,isAutovalue=_this$getAddParameter3.isAutovalue,isAlreadyIncluded=_this$getAddParameter3.isAlreadyIncluded,name=_this$getAddParameter3.name,autovalue=_this$getAddParameter3.autovalue;this.addParameterValueInput.$input.attr("placeholder",autovalue||"");var allowedValues=this.template.paramData[name]&&this.template.paramData[name].allowedValues&&this.template.paramData[name].allowedValues.map(function(val){return{data:val,label:val}});this.addParameterValueInput.setSuggestions(allowedValues||[]),this.addParameterButton.setDisabled(!validName||!validValue),this.addParameterLayout.setNotices(validName&&isAutovalue?["Parameter value will be autofilled"]:[]),this.addParameterLayout.setErrors(isAlreadyIncluded?["Parameter is already present"]:[])},BannerWidget.prototype.onAddParameterValueChange=function(){var _this$getAddParameter4=this.getAddParametersInfo(),validName=_this$getAddParameter4.validName,validValue=_this$getAddParameter4.validValue,isAutovalue=_this$getAddParameter4.isAutovalue;this.addParameterButton.setDisabled(!validName||!validValue),this.addParameterLayout.setNotices(validName&&isAutovalue?["Parameter value will be autofilled"]:[])},BannerWidget.prototype.onParameterAdd=function(){var _this$getAddParameter5=this.getAddParametersInfo(),validName=_this$getAddParameter5.validName,validValue=_this$getAddParameter5.validValue,name=_this$getAddParameter5.name,value=_this$getAddParameter5.value,autovalue=_this$getAddParameter5.autovalue;if(validName&&validValue){var newParameter=new _ParameterWidget.default({name:name,value:value||autovalue},this.template.paramData[name]);this.parameterList.addItems([newParameter]),this.addParameterNameInput.setValue(""),this.addParameterValueInput.setValue(""),this.addParameterNameInput.focus()}},BannerWidget.prototype.onRemoveButtonClick=function(){this.emit("remove")};var _default=BannerWidget;exports.default=_default},{"./ParameterListWidget":5,"./ParameterWidget":6,"./SuggestionLookupTextInputWidget":7}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;function ParameterListWidget(config){if(config=config||{},ParameterListWidget.parent.call(this,config),OO.ui.mixin.GroupElement.call(this,{$group:this.$element}),this.addItems(config.items),config.displayLimit&&this.items.length>config.displayLimit){for(var i=config.displayLimit-1-1;i<this.items.length;i++)this.items[i].toggle(!1);this.showMoreParametersButton=new OO.ui.ButtonWidget({label:"Show "+(this.items.length-config.displayLimit-1)+" more paramters",framed:!1,$element:$("<span style='margin-bottom:0'>")}),this.addItems([this.showMoreParametersButton])}this.addParametersButton=new OO.ui.ButtonWidget({label:"Add paramter",icon:"add",framed:!1,$element:$("<span style='margin-bottom:0'>")}),this.addItems([this.addParametersButton]),this.aggregate({delete:"parameterDelete"}),this.connect(this,{parameterDelete:"onParameterDelete"}),this.showMoreParametersButton&&this.showMoreParametersButton.connect(this,{click:"onShowMoreParametersButtonClick"}),this.addParametersButton.connect(this,{click:"onAddParametersButtonClick"})}OO.inheritClass(ParameterListWidget,OO.ui.Widget),OO.mixinClass(ParameterListWidget,OO.ui.mixin.GroupElement),ParameterListWidget.prototype.onParameterDelete=function(parameter){this.removeItems([parameter])},ParameterListWidget.prototype.getParameterItems=function(){return this.items.filter(function(item){return"ParameterWidget"===item.constructor.name})},ParameterListWidget.prototype.onShowMoreParametersButtonClick=function(){this.removeItems([this.showMoreParametersButton]),this.items.forEach(function(parameterWidget){return parameterWidget.toggle(!0)})},ParameterListWidget.prototype.onAddParametersButtonClick=function(){this.removeItems([this.addParametersButton]),this.emit("addParametersButtonClick")};var _default=ParameterListWidget;exports.default=_default},{}],6:[function(require,module,exports){"use strict";function ParameterWidget(parameter,paramData,config){config=config||{},ParameterWidget.super.call(this,config),this.parameter=parameter,this.paramData=paramData||{},this.allowedValues=paramData&&paramData.allowedValues||[],this.input=new OO.ui.ComboBoxInputWidget({value:this.parameter.value,options:this.allowedValues.map(function(val){return{data:val,label:val}}),$element:$("<div style='width:calc(100% - 70px);margin-right:0;'>")}),this.input.$element.find("input").css({"padding-top":0,"padding-bottom":"2px",height:"24px"}),this.input.$element.find("span.oo-ui-labelElement-label").css({"line-height":"normal"}),this.input.$element.find("a.oo-ui-buttonElement-button").css({"padding-top":0,height:"24px","min-height":"0"}),this.deleteButton=new OO.ui.ButtonWidget({icon:"clear",framed:!1,flags:"destructive"}),this.deleteButton.$element.find("a span").first().css({"min-width":"unset",width:"16px"}),this.confirmButton=new OO.ui.ButtonWidget({icon:"check",framed:!1,flags:"progressive",$element:$("<span style='margin-right:0'>")}),this.confirmButton.$element.find("a span").first().css({"min-width":"unset",width:"16px","margin-right":0}),this.editLayoutControls=new OO.ui.HorizontalLayout({items:[this.input,this.confirmButton,this.deleteButton]}),this.editLayoutControls.getInputId=function(){return!1},this.editLayoutControls.isDisabled=function(){return!1},this.editLayoutControls.simulateLabelClick=function(){return!0},this.editLayout=new OO.ui.FieldLayout(this.editLayoutControls,{label:this.parameter.name+" =",align:"top",help:this.paramData.description&&this.paramData.description.en||!1,helpInline:!0}).toggle(),this.editLayout.$element.find("label.oo-ui-inline-help").css({margin:"-10px 0 5px 10px"}),this.fullLabel=new OO.ui.LabelWidget({label:this.parameter.name+" = "+this.parameter.value,$element:$("<label style='margin: 0;'>")}),this.editButton=new OO.ui.ButtonWidget({icon:"edit",framed:!1,$element:$("<span style='margin-bottom: 0;'>")}),this.editButton.$element.find("a").css({"border-radius":"0 10px 10px 0","margin-left":"5px"}),this.editButton.$element.find("a span").first().css({"min-width":"unset",width:"16px"}),this.readLayout=new OO.ui.HorizontalLayout({items:[this.fullLabel,this.editButton],$element:$("<span style='margin:0;width:unset;'>")}),this.$element=$("<div>").css({width:"unset",display:"inline-block",border:"1px solid #ddd","border-radius":"10px","padding-left":"10px",margin:"0 8px 8px 0"}).append(this.readLayout.$element,this.editLayout.$element),this.editButton.connect(this,{click:"onEditClick"}),this.confirmButton.connect(this,{click:"onConfirmClick"}),this.deleteButton.connect(this,{click:"onDeleteClick"})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,OO.inheritClass(ParameterWidget,OO.ui.Widget),ParameterWidget.prototype.onEditClick=function(){this.readLayout.toggle(!1),this.editLayout.toggle(!0),this.input.focus()},ParameterWidget.prototype.onConfirmClick=function(){this.parameter.value=this.input.getValue(),this.fullLabel.setLabel(this.parameter.name+" = "+this.parameter.value),this.readLayout.toggle(!0),this.editLayout.toggle(!1)},ParameterWidget.prototype.onDeleteClick=function(){this.emit("delete")},ParameterWidget.prototype.focusInput=function(){return this.input.focus()};var _default=ParameterWidget;exports.default=_default},{}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var SuggestionLookupTextInputWidget=function(config){OO.ui.TextInputWidget.call(this,config),OO.ui.mixin.LookupElement.call(this,config),this.suggestions=config.suggestions||[]};OO.inheritClass(SuggestionLookupTextInputWidget,OO.ui.TextInputWidget),OO.mixinClass(SuggestionLookupTextInputWidget,OO.ui.mixin.LookupElement),SuggestionLookupTextInputWidget.prototype.setSuggestions=function(suggestions){this.suggestions=suggestions},SuggestionLookupTextInputWidget.prototype.getLookupRequest=function(){return $.Deferred().resolve(new RegExp("\\b"+mw.util.escapeRegExp(this.getValue()),"i")).promise({abort:function(){}})},SuggestionLookupTextInputWidget.prototype.getLookupCacheDataFromResponse=function(response){return response||[]},SuggestionLookupTextInputWidget.prototype.getLookupMenuOptionsFromData=function(pattern){return this.suggestions.filter(function(suggestionItem){return pattern.test(suggestionItem.label)||!suggestionItem.label&&pattern.test(suggestionItem.data)}).map(function(optionItem){return new OO.ui.MenuOptionWidget({data:optionItem.data,label:optionItem.label||optionItem.data})})};var _default=SuggestionLookupTextInputWidget;exports.default=_default},{}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _util=require("../util");function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function LoadDialog(config){LoadDialog.super.call(this,config)}OO.inheritClass(LoadDialog,OO.ui.Dialog),LoadDialog.static.name="loadDialog",LoadDialog.static.title="Loading Rater...",LoadDialog.prototype.initialize=function(){var _this$content$$elemen;LoadDialog.super.prototype.initialize.call(this),this.content=new OO.ui.PanelLayout({padded:!0,expanded:!1}),this.progressBar=new OO.ui.ProgressBarWidget({progress:1}),this.setuptasks=[new OO.ui.LabelWidget({label:"Loading list of project banners...",$element:$('<p style="display:block">')}),new OO.ui.LabelWidget({label:"Loading talkpage wikitext...",$element:$('<p style="display:block">')}),new OO.ui.LabelWidget({label:"Parsing talkpage templates...",$element:$('<p style="display:block">')}),new OO.ui.LabelWidget({label:"Getting templates' parameter data...",$element:$('<p style="display:block">')}),new OO.ui.LabelWidget({label:"Checking if page redirects...",$element:$('<p style="display:block">')}),new OO.ui.LabelWidget({label:"Retrieving quality prediction...",$element:$('<p style="display:block">')}).toggle()],this.closeButton=new OO.ui.ButtonWidget({label:"Close"}).toggle(),this.setupPromises=[],(_this$content$$elemen=this.content.$element).append.apply(_this$content$$elemen,[this.progressBar.$element,new OO.ui.LabelWidget({label:"Initialising:",$element:$('<strong style="display:block">')}).$element].concat(_toConsumableArray(this.setuptasks.map(function(widget){return widget.$element})),[this.closeButton.$element])),this.$body.append(this.content.$element),this.closeButton.connect(this,{click:"onCloseButtonClick"})},LoadDialog.prototype.onCloseButtonClick=function(){this.close()},LoadDialog.prototype.getBodyHeight=function(){return this.content.$element.outerHeight(!0)},LoadDialog.prototype.incrementProgress=function(amount,maximum){var priorProgress=this.progressBar.getProgress(),incrementedProgress=Math.min(maximum||100,priorProgress+amount);this.progressBar.setProgress(incrementedProgress)},LoadDialog.prototype.addTaskPromiseHandlers=function(taskPromises){var _this=this;taskPromises.forEach(function(promise,index){promise.then(function(){return function(index){var widget=_this.setuptasks[index];widget.setLabel(widget.getLabel()+" Done!");for(var step=0;step<10;step++)window.setTimeout(_this.incrementProgress.bind(_this),400*step/10,2)}(index)},function(code,info){return function(index,code,info){var widget=_this.setuptasks[index];widget.setLabel(widget.getLabel()+" Failed. "+(0,_util.makeErrorMsg)(code,info)),_this.closeButton.toggle(!0),_this.updateSize()}(index,code,info)})})},LoadDialog.prototype.getSetupProcess=function(data){var _this2=this;return data=data||{},LoadDialog.super.prototype.getSetupProcess.call(this,data).next(function(){var showOresTask=!!data.ores;_this2.setuptasks[5].toggle(showOresTask);var taskPromises=data.ores?data.promises:data.promises.slice(0,-1);data.isOpened.then(function(){return _this2.addTaskPromiseHandlers(taskPromises)})},this)},LoadDialog.prototype.getHoldProcess=function(data){return(data=data||{}).success?LoadDialog.super.prototype.getHoldProcess.call(this,data).next(800):LoadDialog.super.prototype.getHoldProcess.call(this,data)},LoadDialog.prototype.getTeardownProcess=function(data){var _this3=this;return LoadDialog.super.prototype.getTeardownProcess.call(this,data).first(function(){_this3.setuptasks.forEach(function(setuptask){var currentLabel=setuptask.getLabel();setuptask.setLabel(currentLabel.slice(0,currentLabel.indexOf("...")+3))})},this)};var _default=LoadDialog;exports.default=_default},{"../util":16}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _BannerWidget=_interopRequireDefault(require("./Components/BannerWidget")),_BannerListWidget=_interopRequireDefault(require("./Components/BannerListWidget")),_SuggestionLookupTextInputWidget=_interopRequireDefault(require("./Components/SuggestionLookupTextInputWidget")),cache=function(obj){if(obj&&obj.__esModule)return obj;var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={};if(null!=obj){var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(require("../cache")),_Template=require("../Template"),_getBanners=require("../getBanners"),_config=_interopRequireDefault(require("../config"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function MainWindow(config){MainWindow.super.call(this,config)}OO.inheritClass(MainWindow,OO.ui.ProcessDialog),MainWindow.static.name="main",MainWindow.static.title="Rater",MainWindow.static.size="large",MainWindow.static.actions=[{label:"X",title:"Close (and discard any changes)",flags:"primary"},{action:"help",flags:"safe",label:"?",title:"help"},{action:"save",label:new OO.ui.HtmlSnippet("<span style='padding:0 1em;'>Save</span>"),flags:["primary","progressive"]},{action:"preview",label:"Show preview"},{action:"changes",label:"Show changes"},{label:"Cancel"}],MainWindow.prototype.initialize=function(){var _this=this;MainWindow.super.prototype.initialize.call(this),this.searchBox=new _SuggestionLookupTextInputWidget.default({placeholder:"Add a WikiProject...",suggestions:cache.read("bannerOptions"),$element:$("<div style='display:inline-block;margin-right:-1px;width:calc(100% - 45px);'>"),$overlay:this.$overlay}),(0,_getBanners.getBannerOptions)().then(function(bannerOptions){return _this.searchBox.setSuggestions(bannerOptions)}),this.addBannerButton=new OO.ui.ButtonWidget({icon:"add",title:"Add",flags:"progressive",$element:$("<span style='float:right;margin:0'>")});var $searchContainer=$("<div style='display:inline-block;width: calc(100% - 220px);min-width: 220px;float:left'>").append(this.searchBox.$element,this.addBannerButton.$element);this.setAllDropDown=new OO.ui.DropdownWidget({icon:"tag",label:"Set all...",invisibleLabel:!0,menu:{items:[new OO.ui.MenuSectionOptionWidget({label:"Classes"})].concat(_toConsumableArray(_config.default.bannerDefaults.classes.map(function(classname){return new OO.ui.MenuOptionWidget({data:{class:classname.toLowerCase()},label:classname})})),[new OO.ui.MenuSectionOptionWidget({label:"Importances"})],_toConsumableArray(_config.default.bannerDefaults.importances.map(function(importance){return new OO.ui.MenuOptionWidget({data:{importance:importance.toLowerCase()},label:importance})})))},$element:$("<span style=\"width:auto;display:inline-block;float:left;margin:0\" title='Set all...'>"),$overlay:this.$overlay}),this.removeAllButton=new OO.ui.ButtonWidget({icon:"trash",title:"Remove all",flags:"destructive"}),this.clearAllButton=new OO.ui.ButtonWidget({icon:"cancel",title:"Clear all",flags:"destructive"}),this.bypassAllButton=new OO.ui.ButtonWidget({icon:"articleRedirect",title:"Bypass all redirects"}),this.menuButtons=new OO.ui.ButtonGroupWidget({items:[this.removeAllButton,this.clearAllButton,this.bypassAllButton],$element:$("<span style='float:left;'>")}),this.menuButtons.$element.prepend(this.setAllDropDown.$element),this.topBar=new OO.ui.PanelLayout({expanded:!1,framed:!1,padded:!1,$element:$("<div style='position:fixed;width:100%;background:#ccc'>")}),this.topBar.$element.append($searchContainer,this.menuButtons.$element),this.$head.css({height:"73px"}).append(this.topBar.$element),this.bannerList=new _BannerListWidget.default,this.$body.css({top:"73px"}).append(this.bannerList.$element),this.searchBox.connect(this,{enter:"onSearchSelect"}),this.addBannerButton.connect(this,{click:"onSearchSelect"})},MainWindow.prototype.getBodyHeight=function(){return Math.max(200,this.bannerList.$element.outerHeight(!0))},MainWindow.prototype.getSetupProcess=function(data){var _this2=this;return data=data||{},MainWindow.super.prototype.getSetupProcess.call(this,data).next(function(){_this2.bannerList.addItems(data.banners.map(function(bannerTemplate){return new _BannerWidget.default(bannerTemplate)})),_this2.talkWikitext=data.talkWikitext,_this2.talkpage=data.talkpage,_this2.updateSize()},this)},MainWindow.prototype.getReadyProcess=function(data){var _this3=this;return data=data||{},MainWindow.super.prototype.getReadyProcess.call(this,data).next(function(){return _this3.searchBox.focus()})},MainWindow.prototype.onSearchSelect=function(){var _this4=this,name=this.searchBox.getValue().trim();if(name&&!this.bannerList.items.find(function(banner){return banner.template.getTitle().getMainText()===name||banner.template.redirectTarget&&banner.template.redirectTarget.getMainText()===name})){if(!/^[Ww](?:P|iki[Pp]roject)/.test(name)){var message=new OO.ui.HtmlSnippet("<code>{{"+name+"}}</code> is not a recognised WikiProject banner.<br/>Do you want to continue?");console.log(message)}if("WikiProject Disambiguation"===name&&0!==$("#ca-talk.new").length&&0===this.bannerList.items.length){console.log("New talk pages shouldn't be created if they will only contain the {{WikiProject Disambiguation}} banner. Continue?")}var template=new _Template.Template;template.name=name,(0,_Template.getWithRedirectTo)(template).then(function(template){return $.when(template.setClassesAndImportances(),template.setParamDataAndSuggestions()).then(function(){return template})}).then(function(template){_this4.bannerList.addItems([new _BannerWidget.default(template)]),_this4.updateSize()})}};var _default=MainWindow;exports.default=_default},{"../Template":2,"../cache":11,"../config":12,"../getBanners":14,"./Components/BannerListWidget":3,"./Components/BannerWidget":4,"./Components/SuggestionLookupTextInputWidget":7}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _config=_interopRequireDefault(require("./config")),_util=require("./util"),_setup=_interopRequireDefault(require("./setup"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _default(){if(null==window.rater_autostartNamespaces||_config.default.mw.wgIsMainPage)return $.Deferred().reject();if(-1===($.isArray(window.rater_autostartNamespaces)?window.rater_autostartNamespaces:[window.rater_autostartNamespaces]).indexOf(_config.default.mw.wgNamespaceNumber))return $.Deferred().reject();if(/(?:\?|&)(?:action|diff|oldid)=/.test(window.location.href))return $.Deferred().reject();if($("#ca-talk.new").length)return(0,_setup.default)();var thisPage=mw.Title.newFromText(_config.default.mw.wgPageName),talkPage=thisPage&&thisPage.getTalkPage();return talkPage?_util.API.get({action:"query",format:"json",prop:"templates",titles:talkPage.getPrefixedText(),tlnamespace:"10",tllimit:"500",indexpageids:1}).then(function(result){var id=result.query.pageids,templates=result.query.pages[id].templates;return templates&&templates.some(function(template){return/(WikiProject|WPBanner)/.test(template.title)})?void 0:(0,_setup.default)()},function(code,jqxhr){return console.warn(""),$.Deferred().reject()}):$.Deferred().reject()}exports.default=_default},{"./config":12,"./setup":15,"./util":16}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clearInvalidItems=exports.clearItemIfInvalid=exports.read=exports.write=void 0;var _util=require("./util");exports.write=function(key,val,staleDays,expiryDays){try{var staleDuration=864e5*(staleDays||1),expiryDuration=864e5*(expiryDays||30),stringVal=JSON.stringify({value:val,staleDate:new Date(Date.now()+staleDuration).toISOString(),expiryDate:new Date(Date.now()+expiryDuration).toISOString()});localStorage.setItem("Rater-"+key,stringVal)}catch(e){}};var read=function(key){var val;try{var stringVal=localStorage.getItem("Rater-"+key);""!==stringVal&&(val=JSON.parse(stringVal))}catch(e){console.log("[Rater] error reading "+key+" from localStorage cache:"),console.log("\t"+e.name+" message: "+e.message+(e.at?" at: "+e.at:"")+(e.text?" text: "+e.text:""))}return val||null};exports.read=read;var clearItemIfInvalid=function(key){if(0===key.indexOf("Rater-")){var item=read(key.replace("Rater-",""));(!item||!item.expiryDate||(0,_util.isAfterDate)(item.expiryDate))&&localStorage.removeItem(key)}};exports.clearItemIfInvalid=clearItemIfInvalid;exports.clearInvalidItems=function(){for(var i=0;i<localStorage.length;i++)setTimeout(clearItemIfInvalid,100,localStorage.key(i))}},{"./util":16}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var config={script:{advert:" ([[User:Evad37/rater.js|Rater]])",version:"2.0.0"}};config.prefs={watchlist:window.rater_watchlist||"preferences"},config.mw=mw.config.get(["skin","wgPageName","wgNamespaceNumber","wgUserName","wgFormattedNamespaces","wgMonthNames","wgRevisionId","wgScriptPath","wgServer","wgCategories","wgIsMainPage"]),config.regex={template:/\{\{\s*([^#\{\s].+?)\s*(\|(?:.|\n)*?(?:(?:\{\{(?:.|\n)*?(?:(?:\{\{(?:.|\n)*?\}\})(?:.|\n)*?)*?\}\})(?:.|\n)*?)*|)\}\}\n?/g,templateParams:/\|(?!(?:[^{]+}|[^\[]+]))(?:.|\s)*?(?=(?:\||$)(?!(?:[^{]+}|[^\[]+])))/g},config.deferred={},config.bannerDefaults={classes:["FA","FL","A","GA","B","C","Start","Stub","List"],importances:["Top","High","Mid","Low"],extendedClasses:["Category","Draft","File","Portal","Project","Template","Bplus","Future","Current","Disambig","NA","Redirect","Book"],extendedImportances:["Top","High","Mid","Low","Bottom","NA"]},config.customClasses={"WikiProject Military history":["AL","BL","CL"],"WikiProject Portals":["FPo","Complete","Substantial","Basic","Incomplete","Meta"]},config.shellTemplates=["WikiProject banner shell","WikiProjectBanners","WikiProject Banners","WPB","WPBS","Wikiprojectbannershell","WikiProject Banner Shell","Wpb","WPBannerShell","Wpbs","Wikiprojectbanners","WP Banner Shell","WP banner shell","Bannershell","Wikiproject banner shell","WikiProject Banners Shell","WikiProjectBanner Shell","WikiProjectBannerShell","WikiProject BannerShell","WikiprojectBannerShell","WikiProject banner shell/redirect","WikiProject Shell","Banner shell","Scope shell","Project shell","WikiProject banner"],config.defaultParameterData={auto:{label:{en:"Auto-rated"},description:{en:"Automatically rated by a bot. Allowed values: ['yes']."},autovalue:"yes"},listas:{label:{en:"List as"},description:{en:"Sortkey for talk page"}},small:{label:{en:"Small?"},description:{en:"Display a small version. Allowed values: ['yes']."},autovalue:"yes"},attention:{label:{en:"Attention required?"},description:{en:"Immediate attention required. Allowed values: ['yes']."},autovalue:"yes"},"needs-image":{label:{en:"Needs image?"},description:{en:"Request that an image or photograph of the subject be added to the article. Allowed values: ['yes']."},aliases:["needs-photo"],autovalue:"yes",suggested:!0},"needs-infobox":{label:{en:"Needs infobox?"},description:{en:"Request that an infobox be added to the article. Allowed values: ['yes']."},aliases:["needs-photo"],autovalue:"yes",suggested:!0}};var _default=config;exports.default=_default},{}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.diffStyles=void 0;exports.diffStyles="table.diff, td.diff-otitle, td.diff-ntitle { background-color: white; }\ntd.diff-otitle, td.diff-ntitle { text-align: center; }\ntd.diff-marker { text-align: right; font-weight: bold; font-size: 1.25em; }\ntd.diff-lineno { font-weight: bold; }\ntd.diff-addedline, td.diff-deletedline, td.diff-context { font-size: 88%; vertical-align: top; white-space: -moz-pre-wrap; white-space: pre-wrap; }\ntd.diff-addedline, td.diff-deletedline { border-style: solid; border-width: 1px 1px 1px 4px; border-radius: 0.33em; }\ntd.diff-addedline { border-color: #a3d3ff; }\ntd.diff-deletedline { border-color: #ffe49c; }\ntd.diff-context { background: #f3f3f3; color: #333333; border-style: solid; border-width: 1px 1px 1px 4px; border-color: #e6e6e6; border-radius: 0.33em; }\n.diffchange { font-weight: bold; text-decoration: none; }\ntable.diff {\n    border: none;\n    width: 98%; border-spacing: 4px;\n    table-layout: fixed; /* Ensures that colums are of equal width */\n}\ntd.diff-addedline .diffchange, td.diff-deletedline .diffchange { border-radius: 0.33em; padding: 0.25em 0; }\ntd.diff-addedline .diffchange {\tbackground: #d8ecff; }\ntd.diff-deletedline .diffchange { background: #feeec8; }\ntable.diff td {\tpadding: 0.33em 0.66em; }\ntable.diff col.diff-marker { width: 2%; }\ntable.diff col.diff-content { width: 48%; }\ntable.diff td div {\n    /* Force-wrap very long lines such as URLs or page-widening char strings. */\n    word-wrap: break-word;\n    /* As fallback (FF<3.5, Opera <10.5), scrollbars will be added for very wide cells\n        instead of text overflowing or widening */\n    overflow: auto;\n}"},{}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getBannerOptions=exports.getBannerNames=void 0;var _util=require("./util"),cache=function(obj){if(obj&&obj.__esModule)return obj;var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={};if(null!=obj){var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(require("./cache"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}var cacheBanners=function(banners,bannerOptions){cache.write("banners",banners,2,60),cache.write("bannerOptions",bannerOptions,2,60)},getListOfBannersFromApi=function(){var finishedPromise=$.Deferred(),querySkeleton={action:"query",format:"json",list:"categorymembers",cmprop:"title",cmnamespace:"10",cmlimit:"500"},categories=[{title:" Category:WikiProject banners with quality assessment",abbreviation:"withRatings",banners:[],processed:$.Deferred()},{title:"Category:WikiProject banners without quality assessment",abbreviation:"withoutRatings",banners:[],processed:$.Deferred()},{title:"Category:WikiProject banner wrapper templates",abbreviation:"wrappers",banners:[],processed:$.Deferred()}],processQuery=function(result,catIndex){if(result.query&&result.query.categorymembers){var resultTitles=result.query.categorymembers.map(function(info){return info.title.slice(9)});Array.prototype.push.apply(categories[catIndex].banners,resultTitles),result.continue?doApiQuery($.extend(categories[catIndex].query,result.continue),catIndex):categories[catIndex].processed.resolve()}else finishedPromise.reject()},doApiQuery=function(q,catIndex){_util.API.get(q).done(function(result){processQuery(result,catIndex)}).fail(function(code,jqxhr){console.warn("[Rater] "+(0,_util.makeErrorMsg)(code,jqxhr,"Could not retrieve pages from [[:"+q.cmtitle+"]]")),finishedPromise.reject()})};return categories.forEach(function(cat,index,arr){cat.query=$.extend({cmtitle:cat.title},querySkeleton),$.when(arr[index-1]&&arr[index-1].processed||!0).then(function(){doApiQuery(cat.query,index)})}),categories[categories.length-1].processed.then(function(){var banners={};categories.forEach(function(catObject){banners[catObject.abbreviation]=catObject.banners});var bannerOptions=categories.reduce(function(mergeIntoThisArray,catObject){return $.merge(mergeIntoThisArray,catObject.banners)},[]).map(function(bannerName){var isWrapper=-1!==$.inArray(bannerName,categories[2].banners);return{data:(isWrapper?"subst:":"")+bannerName,label:bannerName.replace("WikiProject ","")+(isWrapper?" [template wrapper]":"")}});finishedPromise.resolve(banners,bannerOptions)}),finishedPromise},getBannersFromCache=function(){var cachedBanners=cache.read("banners"),cachedBannerOptions=cache.read("bannerOptions");return cachedBanners&&cachedBanners.value&&cachedBanners.staleDate&&cachedBannerOptions&&cachedBannerOptions.value&&cachedBannerOptions.staleDate?(((0,_util.isAfterDate)(cachedBanners.staleDate)||(0,_util.isAfterDate)(cachedBannerOptions.staleDate))&&getListOfBannersFromApi().then(cacheBanners),$.Deferred().resolve(cachedBanners.value,cachedBannerOptions.value)):$.Deferred().reject()};exports.getBannerNames=function(){return getBannersFromCache().then(function(banners){return banners},function(){var bannersPromise=getListOfBannersFromApi();return bannersPromise.then(cacheBanners),bannersPromise})};exports.getBannerOptions=function(){return getBannersFromCache().then(function(_banners,options){return options},function(){var bannersPromise=getListOfBannersFromApi();return bannersPromise.then(cacheBanners),bannersPromise})}},{"./cache":11,"./util":16}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _config=_interopRequireDefault(require("./config")),_util=require("./util"),_Template=require("./Template"),_getBanners=require("./getBanners"),cache=function(obj){if(obj&&obj.__esModule)return obj;var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={};if(null!=obj){var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(require("./cache")),_windowManager=_interopRequireDefault(require("./windowManager"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _default(clickEvent){clickEvent&&clickEvent.preventDefault();var setupCompletedPromise=$.Deferred(),currentPage=mw.Title.newFromText(_config.default.mw.wgPageName),talkPage=currentPage&&currentPage.getTalkPage(),subjectPage=currentPage&&currentPage.getSubjectPage(),bannersPromise=(0,_getBanners.getBannerNames)(),loadTalkPromise=_util.API.get({action:"query",prop:"revisions",rvprop:"content",rvsection:"0",titles:talkPage.getPrefixedText(),indexpageids:1}).then(function(result){var id=result.query.pageids;return id<0?"":result.query.pages[id].revisions[0]["*"]}),parseTalkPromise=loadTalkPromise.then(function(wikitext){return(0,_Template.parseTemplates)(wikitext,!0)}).then(function(templates){return(0,_Template.getWithRedirectTo)(templates)}).then(function(templates){return bannersPromise.then(function(allBanners){return templates.filter(function(template){var mainText=template.redirectTarget?template.redirectTarget.getMainText():template.getTitle().getMainText();return allBanners.withRatings.includes(mainText)||allBanners.withoutRatings.includes(mainText)||allBanners.wrappers.includes(mainText)}).map(function(template){var mainText=template.redirectTarget?template.redirectTarget.getMainText():template.getTitle().getMainText();return allBanners.wrappers.includes(mainText)&&(template.redirectTarget=mw.Title.newFromText("Template:Subst:"+mainText)),template})})}),templateDetailsPromise=parseTalkPromise.then(function(templates){return $.when.apply(null,[].concat(_toConsumableArray(templates.map(function(template){return template.setClassesAndImportances()})),_toConsumableArray(templates.map(function(template){return template.setParamDataAndSuggestions()})))).then(function(){return templates})}),redirectCheckPromise=_util.API.getRaw(subjectPage.getPrefixedText()).then(function(rawPage){return!!/^\s*#REDIRECT/i.test(rawPage)&&(rawPage.slice(rawPage.indexOf("[[")+2,rawPage.indexOf("]]"))||!0)},function(){return null}),shouldGetOres=_config.default.mw.wgNamespaceNumber<=1;if(shouldGetOres)var oresPromise=(currentPage.isTalkPage()?$.Deferred().resolve(_config.default.mw.wgRevisionId):_util.API.get({action:"query",format:"json",prop:"revisions",titles:subjectPage.getPrefixedText(),rvprop:"ids",indexpageids:1}).then(function(result){if(result.query.redirects)return!1;var id=result.query.pageids,page=result.query.pages[id];return""!==page.missing&&(id<0?$.Deferred().reject():page.revisions[0].revid)})).then(function(latestRevId){return!!latestRevId&&_util.API.getORES(latestRevId).then(function(result){var data=result.enwiki.scores[latestRevId].wp10;return data.error?$.Deferred().reject(data.error.type,data.error.message):data.score.prediction})});var isOpenedPromise=$.Deferred(),loadDialogWin=_windowManager.default.openWindow("loadDialog",{promises:[bannersPromise,loadTalkPromise,parseTalkPromise,templateDetailsPromise,redirectCheckPromise,shouldGetOres&&oresPromise],ores:shouldGetOres,isOpened:isOpenedPromise});return loadDialogWin.opened.then(isOpenedPromise.resolve),$.when(loadTalkPromise,templateDetailsPromise,redirectCheckPromise,shouldGetOres&&oresPromise).then(function(talkWikitext,banners,redirectTarget,oresPredicition){var result={success:!0,talkpage:talkPage,talkWikitext:talkWikitext,banners:banners};redirectTarget&&(result.redirectTarget=redirectTarget),oresPredicition&&(result.oresPredicition=oresPredicition),_windowManager.default.closeWindow("loadDialog",result)}),loadDialogWin.closed.then(function(data){data&&data.success?setupCompletedPromise.resolve(data):data&&data.error?setupCompletedPromise.reject(data.error.code,data.error.info):setupCompletedPromise.resolve(null),cache.clearInvalidItems()}),setupCompletedPromise.then(function(data){return console.log("setup window closed",data)},function(code,info){return console.log("setup window closed with error",{code:code,info:info})}),setupCompletedPromise}exports.default=_default},{"./Template":2,"./cache":11,"./config":12,"./getBanners":14,"./util":16,"./windowManager":17}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeErrorMsg=exports.API=exports.isAfterDate=void 0;var obj,_config=(obj=require("./config"))&&obj.__esModule?obj:{default:obj};function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}exports.isAfterDate=function(dateString){return new Date(dateString)<new Date};var API=new mw.Api({ajax:{headers:{"Api-User-Agent":"Rater/"+_config.default.script.version+" ( https://en.wikipedia.org/wiki/User:Evad37/Rater )"}}});(exports.API=API).getORES=function(revisionID){return $.get("https://ores.wikimedia.org/v3/scores/enwiki?models=wp10&revids="+revisionID)},API.getRaw=function(page){return $.get("https:"+_config.default.mw.wgServer+mw.util.getUrl(page,{action:"raw"})).then(function(data){return data||$.Deferred().reject("ok-but-empty")})};exports.makeErrorMsg=function(first,second){var code,xhr,message;if("object"===_typeof(first)&&"string"==typeof second){var errorObj=first.responseJSON&&first.responseJSON.error;errorObj?(code=errorObj.code,message=errorObj.message):xhr=first}else if("string"==typeof first&&"object"===_typeof(second)){second.error?(code=errorObj.code,message=errorObj.info):"ok-but-empty"===first?(code=null,message="Got an empty response from the server"):xhr=second&&second.xhr}return code&&message?"API error ".concat(code,": ").concat(message):message?"API error: ".concat(message):xhr?"HTTP error ".concat(xhr.status):"string"==typeof first&&"error"!==first&&"string"==typeof second&&"error"!==second?"Error ".concat(first,": ").concat(second):"string"==typeof first&&"error"!==first?"Error: ".concat(first):"Unknown API error"}},{"./config":12}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _LoadDialog=_interopRequireDefault(require("./Windows/LoadDialog")),_MainWindow=_interopRequireDefault(require("./Windows/MainWindow"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var factory=new OO.Factory;factory.register(_LoadDialog.default),factory.register(_MainWindow.default);var manager=new OO.ui.WindowManager({factory:factory});$(document.body).append(manager.$element);var _default=manager;exports.default=_default},{"./Windows/LoadDialog":8,"./Windows/MainWindow":9}]},{},[1]);