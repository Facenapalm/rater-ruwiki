!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";var _setup=_interopRequireDefault(require("./setup")),_autostart=_interopRequireDefault(require("./autostart")),_css=_interopRequireDefault(require("./css.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}console.log("Rater's App.js is running..."),mw.util.addCSS(_css.default),mw.util.addPortletLink("p-cactions","#","Rater","ca-rater","Rate quality and importance","5"),$("#ca-rater").click(_setup.default),(0,_autostart.default)()},{"./autostart":4,"./css.js":7,"./setup":9}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;function LoadDialog(config){LoadDialog.super.call(this,config)}var _util=require("./util"),progressBar=new OO.ui.ProgressBarWidget({progress:1}),incrementProgress=function(amount,maximum){var priorProgress=progressBar.getProgress(),incrementedProgress=Math.min(maximum||100,priorProgress+amount);progressBar.setProgress(incrementedProgress)};OO.inheritClass(LoadDialog,OO.ui.Dialog),LoadDialog.static.name="loadDialog",LoadDialog.static.title="Loading Rater...",LoadDialog.prototype.initialize=function(){LoadDialog.super.prototype.initialize.call(this),this.content=new OO.ui.PanelLayout({padded:!0,expanded:!1}),this.content.$element.append(progressBar.$element,$("<p>").attr("id","dialog-loading-0").css("font-weight","bold").text("Initialising:"),$("<p>").attr("id","dialog-loading-1").text("Loading talkpage wikitext..."),$("<p>").attr("id","dialog-loading-2").text("Parsing talkpage templates..."),$("<p>").attr("id","dialog-loading-3").text("Getting templates' parameter data..."),$("<p>").attr("id","dialog-loading-4").text("Checking if page redirects..."),$("<p>").attr("id","dialog-loading-5").text("Retrieving quality prediction...").hide()),this.$body.append(this.content.$element)},LoadDialog.prototype.getBodyHeight=function(){return this.content.$element.outerHeight(!0)},LoadDialog.prototype.showTaskDone=function(taskNumber){if($("#dialog-loading-"+taskNumber).append(" Done!"),5===taskNumber)return incrementProgress(100),void window.setTimeout(function(){$("#dialog-loading").hide()},100);for(var step=0;step<10;step++)window.setTimeout(incrementProgress,400*step/10,2)},LoadDialog.prototype.showTaskFailed=function(taskNumber,code,jqxhr){$("#dialog-loading-"+taskNumber).append(" Failed.",null==code?"":" "+(0,_util.makeErrorMsg)(code,jqxhr))};var _default=LoadDialog;exports.default=_default},{"./util":10}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getWithRedirectTo=exports.parseTemplates=exports.Template=void 0;var obj,_util=require("./util"),_config=(obj=require("./config"))&&obj.__esModule?obj:{default:obj},cache=function(obj){if(obj&&obj.__esModule)return obj;var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={};if(null!=obj){var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(require("./cache"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}var Template=function(wikitext){this.wikitext=wikitext,this.parameters=[]};(exports.Template=Template).prototype.addParam=function(name,val,wikitext){this.parameters.push({name:name,value:val,wikitext:"|"+wikitext})},Template.prototype.getParam=function(paramName){return this.parameters.find(function(p){return p.name==paramName})},Template.prototype.setName=function(name){this.name=name.trim()},Template.prototype.getTitle=function(){return mw.Title.newFromText("Template:"+this.name)};exports.parseTemplates=function parseTemplates(wikitext,recursive){for(var startIdx,strReplaceAt=function(string,index,_char){return string.slice(0,index)+_char+string.slice(index+1)},result=[],processTemplateText=function(startIdx,endIdx){for(var text=wikitext.slice(startIdx,endIdx),template=new Template("{{"+text.replace(/\x01/g,"|")+"}}");/(\[\[[^\]]*?)\|(.*?\]\])/g.test(text);)text=text.replace(/(\[\[[^\]]*?)\|(.*?\]\])/g,"$1$2");var chunks=text.split("|").map(function(chunk){return chunk.replace(/\x01/g,"|")});template.setName(chunks[0]);var parameterChunks=chunks.slice(1),unnamedIdx=1;parameterChunks.forEach(function(chunk){var pName,pNum,pVal,indexOfEqualTo=chunk.indexOf("="),indexOfOpenBraces=chunk.indexOf("{{"),isWithoutEquals=!chunk.includes("="),hasBracesBeforeEquals=chunk.includes("{{")&&indexOfOpenBraces<indexOfEqualTo;if(isWithoutEquals||hasBracesBeforeEquals){for(;template.getParam(unnamedIdx);)unnamedIdx++;pNum=unnamedIdx,pVal=chunk.trim()}else pName=chunk.slice(0,indexOfEqualTo).trim(),pVal=chunk.slice(indexOfEqualTo+1).trim();template.addParam(pName||pNum,pVal,chunk)}),result.push(template)},n=wikitext.length,numUnclosed=0,inComment=!1,inNowiki=!1,i=0;i<n;i++)inComment||inNowiki?"|"===wikitext[i]?wikitext=strReplaceAt(wikitext,i,""):/^-->/.test(wikitext.slice(i,i+3))?(inComment=!1,i+=2):/^<\/nowiki ?>/.test(wikitext.slice(i,i+10))&&(inNowiki=!1,i+=8):"{"===wikitext[i]&&"{"===wikitext[i+1]?(0===numUnclosed&&(startIdx=i+2),numUnclosed+=2,i++):"}"===wikitext[i]&&"}"===wikitext[i+1]?(2===numUnclosed&&processTemplateText(startIdx,i),numUnclosed-=2,i++):"|"===wikitext[i]&&2<numUnclosed?wikitext=strReplaceAt(wikitext,i,""):/^<!--/.test(wikitext.slice(i,i+4))?(inComment=!0,i+=3):/^<nowiki ?>/.test(wikitext.slice(i,i+9))&&(inNowiki=!0,i+=7);if(recursive){var subtemplates=result.map(function(template){return template.wikitext.slice(2,-2)}).filter(function(templateWikitext){return/\{\{.*\}\}/.test(templateWikitext)}).map(function(templateWikitext){return parseTemplates(templateWikitext,!0)});return result.concat.apply(result,subtemplates)}return result};exports.getWithRedirectTo=function(templates){var templatesArray=Array.isArray(templates)?templates:[templates];return _util.API.get({action:"query",format:"json",titles:templatesArray.map(function(template){return template.getTitle().getPrefixedText()}),redirects:1}).then(function(result){return result&&result.query?(result.query.redirects&&result.query.redirects.forEach(function(redirect){var i=templatesArray.findIndex(function(template){return template.getTitle().getPrefixedText()===redirect.from});-1!==i&&(templatesArray[i].redirectsTo=mw.Title.newFromText(redirect.to))}),templatesArray):$.Deferred().reject("Empty response")})},Template.prototype.getDataForParam=function(key,paraName){if(!this.paramData)return null;var para=this.paramAliases[paraName]||paraName;if(this.paramData[para]){var data=this.paramData[para][key];return data&&data.en&&!Array.isArray(data)?data.en:data}},Template.prototype.setParamDataAndSuggestions=function(){var self=this,paramDataSet=$.Deferred();if(self.paramData)return paramDataSet.resolve();var prefixedText=self.redirectsTo?self.redirectsTo.getPrefixedText():self.getTitle().getPrefixedText(),cachedInfo=cache.read(prefixedText+"-params");return cachedInfo&&cachedInfo.value&&cachedInfo.staleDate&&null!=cachedInfo.value.paramData&&null!=cachedInfo.value.parameterSuggestions&&null!=cachedInfo.value.paramAliases&&(self.notemplatedata=cachedInfo.value.notemplatedata,self.paramData=cachedInfo.value.paramData,self.parameterSuggestions=cachedInfo.value.parameterSuggestions,self.paramAliases=cachedInfo.value.paramAliases,paramDataSet.resolve(),!(0,_util.isAfterDate)(cachedInfo.staleDate))||_util.API.get({action:"templatedata",titles:prefixedText,redirects:1,includeMissingTitles:1}).then(function(response){return response},function(){return null}).then(function(result){var id=result&&$.map(result.pages,function(_value,key){return key});result&&result.pages[id]&&!result.pages[id].notemplatedata&&result.pages[id].params?self.paramData=result.pages[id].params:(self.notemplatedata=!0,self.templatedataApiError=!result,self.paramData=_config.default.defaultParameterData),self.paramAliases={},$.each(self.paramData,function(paraName,paraData){if(paraData.aliases&&paraData.aliases.length&&paraData.aliases.forEach(function(alias){self.paramAliases[alias]=paraName}),paraData.description&&/\[.*'.+?'.*?\]/.test(paraData.description.en))try{var allowedVals=JSON.parse(paraData.description.en.replace(/^.*\[/,"[").replace(/"/g,'\\"').replace(/'/g,'"').replace(/,\s*]/,"]").replace(/].*$/,"]"));self.paramData[paraName].allowedValues=allowedVals}catch(e){console.warn("[Rater] Could not parse allowed values in description:\n  "+paraData.description.en+"\n Check TemplateData for parameter |"+paraName+"= in "+self.getTitle().getPrefixedText())}if((paraData.required||paraData.suggested)&&!self.getParam(paraName)){if(paraData.aliases.length)if(self.parameters.filter(function(p){var isAlias=paraData.aliases.includes(p.name),isEmpty=!p.val;return isAlias&&!isEmpty}).length)return;self.parameters.push({name:paraName,value:paraData.autovalue||"",autofilled:!0})}});var allParamsArray=!self.notemplatedata&&result.pages[id].paramOrder||$.map(self.paramData,function(_val,key){return key});return self.parameterSuggestions=allParamsArray.filter(function(paramName){return paramName&&"class"!==paramName&&"importance"!==paramName}).map(function(paramName){var optionObject={data:paramName},label=self.getDataForParam(label,paramName);return label&&(optionObject.label=label+" (|"+paramName+"=)"),optionObject}),self.templatedataApiError||cache.write(prefixedText+"-params",{notemplatedata:self.notemplatedata,paramData:self.paramData,parameterSuggestions:self.parameterSuggestions,paramAliases:self.paramAliases},1),!0}).then(paramDataSet.resolve,paramDataSet.reject),paramDataSet}},{"./cache":5,"./config":6,"./util":10}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _config=_interopRequireDefault(require("./config")),_util=require("./util"),_setup=_interopRequireDefault(require("./setup"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _default(){if(null!=window.rater_autostartNamespaces&&!_config.default.mw.wgIsMainPage&&-1!==($.isArray(window.rater_autostartNamespaces)?window.rater_autostartNamespaces:[window.rater_autostartNamespaces]).indexOf(_config.default.mw.wgNamespaceNumber)&&!/(?:\?|&)(?:action|diff|oldid)=/.test(window.location.href))if($("#ca-talk.new").length)(0,_setup.default)();else{var thisPage=mw.Title.newFromText(_config.default.mw.wgPageName),talkPage=thisPage&&thisPage.getTalkPage();talkPage&&_util.API.get({action:"query",format:"json",prop:"templates",titles:talkPage.getPrefixedText(),tlnamespace:"10",tllimit:"500",indexpageids:1}).done(function(result){var id=result.query.pageids,templates=result.query.pages[id].templates;templates?templates.some(function(template){return/(WikiProject|WPBanner)/.test(template.title)})||(0,_setup.default)():(0,_setup.default)()}).fail(function(code,jqxhr){console.warn("")})}}exports.default=_default},{"./config":6,"./setup":9,"./util":10}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clearInvalidItems=exports.clearItemIfInvalid=exports.read=exports.write=void 0;var _util=require("./util");exports.write=function(key,val,staleDays,expiryDays){try{var staleDuration=864e5*(staleDays||1),expiryDuration=864e5*(expiryDays||30),stringVal=JSON.stringify({value:val,staleDate:new Date(Date.now()+staleDuration).toISOString(),expiryDate:new Date(Date.now()+expiryDuration).toISOString()});localStorage.setItem("Rater-"+key,stringVal)}catch(e){}};var read=function(key){var val;try{var stringVal=localStorage.getItem("Rater-"+key);""!==stringVal&&(val=JSON.parse(stringVal))}catch(e){console.log("[Rater] error reading "+key+" from localStorage cache:"),console.log("\t"+e.name+" message: "+e.message+(e.at?" at: "+e.at:"")+(e.text?" text: "+e.text:""))}return val||null};exports.read=read;var clearItemIfInvalid=function(key){if(0===key.indexOf("Rater-")){var item=read(key.replace("Rater-",""));(!item||!item.expiryDate||(0,_util.isAfterDate)(item.expiryDate))&&localStorage.removeItem(key)}};exports.clearItemIfInvalid=clearItemIfInvalid;exports.clearInvalidItems=function(){for(var i=0;i<localStorage.length;i++)setTimeout(clearItemIfInvalid,100,localStorage.key(i))}},{"./util":10}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var config={script:{advert:" ([[User:Evad37/rater.js|Rater]])",version:"1.3.1"}};config.prefs={watchlist:window.rater_watchlist||"preferences"},config.mw=mw.config.get(["skin","wgPageName","wgNamespaceNumber","wgUserName","wgFormattedNamespaces","wgMonthNames","wgRevisionId","wgScriptPath","wgServer","wgCategories","wgIsMainPage"]),config.regex={template:/\{\{\s*([^#\{\s].+?)\s*(\|(?:.|\n)*?(?:(?:\{\{(?:.|\n)*?(?:(?:\{\{(?:.|\n)*?\}\})(?:.|\n)*?)*?\}\})(?:.|\n)*?)*|)\}\}\n?/g,templateParams:/\|(?!(?:[^{]+}|[^\[]+]))(?:.|\s)*?(?=(?:\||$)(?!(?:[^{]+}|[^\[]+])))/g},config.deferred={},config.bannerDefaults={classes:["FA","FL","A","GA","B","C","Start","Stub","List"],importances:["Top","High","Mid","Low"],extendedClasses:["Category","Draft","File","Portal","Project","Template","Bplus","Future","Current","Disambig","NA","Redirect","Book"],extendedImportances:["Top","High","Mid","Low","Bottom","NA"]},config.customClasses={"WikiProject Military history":["AL","BL","CL"],"WikiProject Portals":["FPo","Complete","Substantial","Basic","Incomplete","Meta"]},config.shellTemplates=["WikiProject banner shell","WikiProjectBanners","WikiProject Banners","WPB","WPBS","Wikiprojectbannershell","WikiProject Banner Shell","Wpb","WPBannerShell","Wpbs","Wikiprojectbanners","WP Banner Shell","WP banner shell","Bannershell","Wikiproject banner shell","WikiProject Banners Shell","WikiProjectBanner Shell","WikiProjectBannerShell","WikiProject BannerShell","WikiprojectBannerShell","WikiProject banner shell/redirect","WikiProject Shell","Banner shell","Scope shell","Project shell","WikiProject banner"],config.defaultParameterData={auto:{label:{en:"Auto-rated"},description:{en:"Automatically rated by a bot. Allowed values: ['yes']."},autovalue:"yes"},listas:{label:{en:"List as"},description:{en:"Sortkey for talk page"}},small:{label:{en:"Small?"},description:{en:"Display a small version. Allowed values: ['yes']."},autovalue:"yes"},attention:{label:{en:"Attention required?"},description:{en:"Immediate attention required. Allowed values: ['yes']."},autovalue:"yes"},"needs-image":{label:{en:"Needs image?"},description:{en:"Request that an image or photograph of the subject be added to the article. Allowed values: ['yes']."},aliases:["needs-photo"],autovalue:"yes",suggested:!0},"needs-infobox":{label:{en:"Needs infobox?"},description:{en:"Request that an infobox be added to the article. Allowed values: ['yes']."},aliases:["needs-photo"],autovalue:"yes",suggested:!0}};var _default=config;exports.default=_default},{}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.diffStyles=void 0;exports.diffStyles="table.diff, td.diff-otitle, td.diff-ntitle { background-color: white; }\ntd.diff-otitle, td.diff-ntitle { text-align: center; }\ntd.diff-marker { text-align: right; font-weight: bold; font-size: 1.25em; }\ntd.diff-lineno { font-weight: bold; }\ntd.diff-addedline, td.diff-deletedline, td.diff-context { font-size: 88%; vertical-align: top; white-space: -moz-pre-wrap; white-space: pre-wrap; }\ntd.diff-addedline, td.diff-deletedline { border-style: solid; border-width: 1px 1px 1px 4px; border-radius: 0.33em; }\ntd.diff-addedline { border-color: #a3d3ff; }\ntd.diff-deletedline { border-color: #ffe49c; }\ntd.diff-context { background: #f3f3f3; color: #333333; border-style: solid; border-width: 1px 1px 1px 4px; border-color: #e6e6e6; border-radius: 0.33em; }\n.diffchange { font-weight: bold; text-decoration: none; }\ntable.diff {\n    border: none;\n    width: 98%; border-spacing: 4px;\n    table-layout: fixed; /* Ensures that colums are of equal width */\n}\ntd.diff-addedline .diffchange, td.diff-deletedline .diffchange { border-radius: 0.33em; padding: 0.25em 0; }\ntd.diff-addedline .diffchange {\tbackground: #d8ecff; }\ntd.diff-deletedline .diffchange { background: #feeec8; }\ntable.diff td {\tpadding: 0.33em 0.66em; }\ntable.diff col.diff-marker { width: 2%; }\ntable.diff col.diff-content { width: 48%; }\ntable.diff td div {\n    /* Force-wrap very long lines such as URLs or page-widening char strings. */\n    word-wrap: break-word;\n    /* As fallback (FF<3.5, Opera <10.5), scrollbars will be added for very wide cells\n        instead of text overflowing or widening */\n    overflow: auto;\n}"},{}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _util=require("./util"),cache=function(obj){if(obj&&obj.__esModule)return obj;var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={};if(null!=obj){var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(require("./cache"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}function _default(){return function(){var cachedBanners=cache.read("banners"),cachedBannerOptions=cache.read("bannerOptions");return cachedBanners&&cachedBanners.value&&cachedBanners.staleDate&&cachedBannerOptions&&cachedBannerOptions.value&&cachedBannerOptions.staleDate?(((0,_util.isAfterDate)(cachedBanners.staleDate)||(0,_util.isAfterDate)(cachedBannerOptions.staleDate))&&getListOfBannersFromApi().then(cacheBanners),$.Deferred().resolve(cachedBanners.value,cachedBannerOptions.value)):$.Deferred().reject()}().then(function(banners,options){return $.Deferred().resolve(banners,options)},function(){var bannersPromise=getListOfBannersFromApi();return bannersPromise.then(cacheBanners),bannersPromise})}var cacheBanners=function(banners,bannerOptions){cache.write("banners",banners,2,60),cache.write("bannerOptions",bannerOptions,2,60)},getListOfBannersFromApi=function(){var finishedPromise=$.Deferred(),querySkeleton={action:"query",format:"json",list:"categorymembers",cmprop:"title",cmnamespace:"10",cmlimit:"500"},categories=[{title:" Category:WikiProject banners with quality assessment",abbreviation:"withRatings",banners:[],processed:$.Deferred()},{title:"Category:WikiProject banners without quality assessment",abbreviation:"withoutRatings",banners:[],processed:$.Deferred()},{title:"Category:WikiProject banner wrapper templates",abbreviation:"wrappers",banners:[],processed:$.Deferred()}],processQuery=function(result,catIndex){if(result.query&&result.query.categorymembers){var resultTitles=result.query.categorymembers.map(function(info){return info.title.slice(9)});Array.prototype.push.apply(categories[catIndex].banners,resultTitles),result.continue?doApiQuery($.extend(categories[catIndex].query,result.continue),catIndex):categories[catIndex].processed.resolve()}else finishedPromise.reject()},doApiQuery=function(q,catIndex){_util.API.get(q).done(function(result){processQuery(result,catIndex)}).fail(function(code,jqxhr){console.warn("[Rater] "+(0,_util.makeErrorMsg)(code,jqxhr,"Could not retrieve pages from [[:"+q.cmtitle+"]]")),finishedPromise.reject()})};return categories.forEach(function(cat,index,arr){cat.query=$.extend({cmtitle:cat.title},querySkeleton),$.when(arr[index-1]&&arr[index-1].processed||!0).then(function(){doApiQuery(cat.query,index)})}),categories[categories.length-1].processed.then(function(){var banners={};categories.forEach(function(catObject){banners[catObject.abbreviation]=catObject.banners});var bannerOptions=categories.reduce(function(mergeIntoThisArray,catObject){return $.merge(mergeIntoThisArray,catObject.banners)},[]).map(function(bannerName){var isWrapper=-1!==$.inArray(bannerName,categories[2].banners);return{data:(isWrapper?"subst:":"")+bannerName,label:bannerName.replace("WikiProject ","")+(isWrapper?" [template wrapper]":"")}});finishedPromise.resolve(banners,bannerOptions)}),finishedPromise};exports.default=_default},{"./cache":5,"./util":10}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _config=_interopRequireDefault(require("./config")),_LoadDialog=_interopRequireDefault(require("./LoadDialog")),_util=require("./util"),_Template=require("./Template"),_getBanners=_interopRequireDefault(require("./getBanners")),cache=function(obj){if(obj&&obj.__esModule)return obj;var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={};if(null!=obj){var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(require("./cache"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function(){return cache},cache}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _default(clickEvent){clickEvent&&clickEvent.preventDefault();var setupCompletedPromise=$.Deferred(),currentPage=mw.Title.newFromText(_config.default.mw.wgPageName),talkPage=currentPage&&currentPage.getTalkPage(),subjectPage=currentPage&&currentPage.getSubjectPage(),loadDialog=new _LoadDialog.default({size:"medium"}),windowManager=new OO.ui.WindowManager;$(document.body).append(windowManager.$element),windowManager.addWindows([loadDialog]);var loadDialogWin=windowManager.openWindow(loadDialog),bannersPromise=(0,_getBanners.default)(),loadTalkPromise=_util.API.get({action:"query",prop:"revisions",rvprop:"content",rvsection:"0",titles:talkPage.getPrefixedText(),indexpageids:1}).then(function(result){var id=result.query.pageids;return id<0?"":result.query.pages[id].revisions[0]["*"]});loadTalkPromise.then(function(){loadDialog.showTaskDone(1)},function(code,jqxhr){loadDialog.showTaskFailed(1,code,jqxhr)});var parseTalkPromise=loadTalkPromise.then(function(wikitext){return(0,_Template.parseTemplates)(wikitext,!0)}).then(function(templates){return(0,_Template.getWithRedirectTo)(templates)}).then(function(templates){return bannersPromise.then(function(allBanners){return templates.filter(function(template){var mainText=template.redirectTo?template.redirectTo.getMainText():template.getTitle().getMainText();return allBanners.withRatings.includes(mainText)||allBanners.withoutRatings.includes(mainText)||allBanners.wrappers.includes(mainText)}).map(function(template){var mainText=template.redirectTo?template.redirectTo.getMainText():template.getTitle().getMainText();return allBanners.wrappers.includes(mainText)&&(template.redirectsTo=mw.Title.newFromText("Template:Subst:"+mainText)),template})})});parseTalkPromise.then(function(){loadDialog.showTaskDone(2)},function(code,jqxhr){loadDialog.showTaskFailed(2,code,jqxhr)});var templateDataPromise=parseTalkPromise.then(function(templates){return templates.forEach(function(template){return template.setParamDataAndSuggestions()}),templates});templateDataPromise.then(function(){loadDialog.showTaskDone(3)});var redirectCheckPromise=_util.API.getRaw(subjectPage.getPrefixedText()).then(function(rawPage){return!!/^\s*#REDIRECT/i.test(rawPage)&&(rawPage.slice(rawPage.indexOf("[[")+2,rawPage.indexOf("]]"))||!0)},function(){return null});redirectCheckPromise.then(function(){loadDialog.showTaskDone(4)});var shouldGetOres=_config.default.mw.wgNamespaceNumber<=1;if(shouldGetOres){$("#dialog-loading-5").show();var oresPromise=(currentPage.isTalkPage()?$.Deferred().resolve(_config.default.mw.wgRevisionId):_util.API.get({action:"query",format:"json",prop:"revisions",titles:subjectPage.getPrefixedText(),rvprop:"ids",indexpageids:1}).then(function(result){if(result.query.redirects)return!1;var id=result.query.pageids,page=result.query.pages[id];return""!==page.missing&&(id<0?$.Deferred().reject():page.revisions[0].revid)})).then(function(latestRevId){return!!latestRevId&&_util.API.getORES(latestRevId).then(function(result){var data=result.enwiki.scores[latestRevId].wp10;return data.error?$.Deferred().reject(data.error.type,data.error.message):data.score.prediction})});oresPromise.then(function(){loadDialog.showTaskDone(4)},function(code,jqxhr){loadDialog.showTaskFailed(4,code,jqxhr);var waitPromise=$.Deferred();return setTimeout(waitPromise.resolve,2e3),waitPromise})}return $.when(loadTalkPromise,templateDataPromise,redirectCheckPromise,shouldGetOres&&oresPromise).then(function(talkWikitext,banners,redirectTarget,oresPredicition){var result={success:!0,talkpage:talkPage,talkWikitext:talkWikitext,banners:banners};redirectTarget&&(result.redirectTarget=redirectTarget),oresPredicition&&(result.oresPredicition=oresPredicition),windowManager.closeWindow(loadDialog,result),cache.clearInvalidItems()},function(){return setTimeout(function(){return windowManager.closeWindow(loadDialog)},3e3)}),loadDialogWin.closed.then(function(data){data&&data.success?setupCompletedPromise.resolve(data):setupCompletedPromise.reject()}),setupCompletedPromise.then(function(data){return console.log("setup window closed",data)}),setupCompletedPromise}exports.default=_default},{"./LoadDialog":2,"./Template":3,"./cache":5,"./config":6,"./getBanners":8,"./util":10}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeErrorMsg=exports.API=exports.isAfterDate=void 0;var obj,_config=(obj=require("./config"))&&obj.__esModule?obj:{default:obj};exports.isAfterDate=function(dateString){return new Date(dateString)<new Date};var API=new mw.Api({ajax:{headers:{"Api-User-Agent":"Rater/"+_config.default.script.version+" ( https://en.wikipedia.org/wiki/User:Evad37/Rater )"}}});(exports.API=API).getORES=function(revisionID){return $.get("https://ores.wikimedia.org/v3/scores/enwiki?models=wp10&revids="+revisionID)},API.getRaw=function(page){var request=$.get("https:"+_config.default.mw.wgServer+mw.util.getUrl(page,{action:"raw"})).then(function(data){if(!data)return $.Deferred().reject("ok-but-empty")},function(){var status=request.getResponseHeader("status");return $.Deferred().reject("http",{textstatus:status||"unknown"})});return request};exports.makeErrorMsg=function(code,jqxhr){return"http"===code&&"error"===jqxhr.textStatus?"HTTP error "+jqxhr.xhr.status:"http"===code?"HTTP error: "+jqxhr.textStatus:"ok-but-empty"===code?"Error: Got an empty response from the server":"API error: "+code}},{"./config":6}]},{},[1]);